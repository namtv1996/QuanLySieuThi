!function(e){function t(e,t,s,a,n){function c(){var s={params:{parentID:"DH",vouchertype1:10,vouchertype2:14}};t.get("api/saleOrder/getCode",s,function(t){e.saleOrders.VoucherNo=t.data})}function r(){""!=e.searchText?e.dis="block":e.dis="none"}function u(t){if("none"===e.cart.list_selected[t-1].display_discount){e.cart.list_selected[t-1].display_discount="block";for(var s=0;s<e.cart.list_selected.length;s++)s!==t-1&&(e.cart.list_selected[s].display_discount="none")}else e.cart.list_selected[t-1].display_discount="none"}function d(t){e.cart.list_selected[t-1].status_discount===!1?(Number(A(e.cart.list_selected[t-1].txt_discount_item))>100&&(e.cart.list_selected[t-1].txt_discount_item="100"),Number(A(e.cart.list_selected[t-1].txt_discount_item))<=0&&(e.cart.list_selected[t-1].txt_discount_item="0")):e.cart.list_selected[t-1].txt_discount_item=S(e.cart.list_selected[t-1].txt_discount_item)}function m(t){""!==e.cart.list_selected[t-1].txt_discount_item&&null!==e.cart.list_selected[t-1].txt_discount_item&&"0"!==e.cart.list_selected[t-1].txt_discount_item&&(e.cart.list_selected[t-1].status_discount===!1?e.cart.list_selected[t-1].txt_discount_item=Number(100*Number(A(e.cart.list_selected[t-1].txt_discount_item))/(e.cart.list_selected[t-1].quan*Number(A(e.cart.list_selected[t-1].unit_price)))):e.cart.list_selected[t-1].txt_discount_item=S((Number(e.cart.list_selected[t-1].txt_discount_item)*e.cart.list_selected[t-1].quan*Number(A(e.cart.list_selected[t-1].unit_price))/100).toFixed(2)))}function _(t){e.cart.list_selected[t-1].status_discount===!1?e.cart.list_selected[t-1].discount=S(Number(e.cart.list_selected[t-1].txt_discount_item)*e.cart.list_selected[t-1].quan*Number(A(e.cart.list_selected[t-1].unit_price))/100):e.cart.list_selected[t-1].discount=e.cart.list_selected[t-1].txt_discount_item,e.update_info(),e.cart.list_selected[t-1].display_discount="none"}function p(t){if(e.disabled="none",e.disabled1="block",t.discount2=0,e.displaycart="none",0==e.cart.list_selected.length)t.quan=1,t.stt=1,t.status_discount=!0,t.display_discount="none",t.txt_discount_item="0",t.discount="0",t.vat=0,t.unit_price=S(t.saleprice.toString()),null!==e.customers.ObjectName&&""!==e.customers.ObjectName&&("3048ffe8-e2c8-4b43-a8a5-766ad6643a83"===e.customers.PricePolicyDefault.toString()?t.unit_price=S(t.saleprice.toString()):("f53cecc7-5a7b-44b9-894b-c6b18ac85d49"===e.customers.PricePolicyDefault.toString()&&(t.unit_price=S(t.WholesalePrice.toString())),"155acc95-47be-4169-a73a-872aec588f54"===e.customers.PricePolicyDefault.toString()&&(t.unit_price=S(t.PurchasePrice.toString()))),t.vat=e.customers.TaxRateDefault),t.money_amount=Number(A(t.unit_price))*t.quan-Number(A(t.discount)),e.cart.list_selected.push(t);else{var s=-1,o=1;for(var l in e.cart.list_selected)e.cart.list_selected[l].ID==t.ID&&(s=l),o++;-1==s?(t.quan=1,t.stt=o,t.status_discount=!0,t.display_discount="none",t.txt_discount_item="0",t.discount="0",t.vat=0,t.unit_price=S(t.saleprice.toString()),null!==e.customers.ObjectName&&""!==e.customers.ObjectName&&("3048ffe8-e2c8-4b43-a8a5-766ad6643a83"===e.customers.PricePolicyDefault.toString()?t.unit_price=S(t.saleprice.toString()):("f53cecc7-5a7b-44b9-894b-c6b18ac85d49"===e.customers.PricePolicyDefault.toString()&&(t.unit_price=S(t.WholesalePrice.toString())),"155acc95-47be-4169-a73a-872aec588f54"===e.customers.PricePolicyDefault.toString()&&(t.unit_price=S(t.PurchasePrice.toString()))),t.vat=e.customers.TaxRateDefault),t.money_amount=Number(A(t.unit_price))*t.quan-Number(A(t.discount)),e.cart.list_selected.push(t)):(e.cart.list_selected[s].quan++,e.cart.list_selected[s].money_amount=Number(A(e.cart.list_selected[s].unit_price))*e.cart.list_selected[s].quan-Number(A(e.cart.list_selected[s].discount)))}e.dis="none",e.searchText="",e.update_info()}function D(){void 0===e.shipping_amount?e.shipping_amount="0":e.shipping_amount=S(A(e.shipping_amount.toString()));var t=0;e.quantity=0,e.total=0,e.saleOrders.TotalDiscountAmount=0,e.saleOrders.TotalVATAmount=0;for(var s in e.cart.list_selected)void 0===e.cart.list_selected[s].unit_price?e.cart.list_selected[s].unit_price="0":e.cart.list_selected[s].unit_price=S(A(e.cart.list_selected[s].unit_price.toString())),void 0===e.cart.list_selected[s].discount?e.cart.list_selected[s].discount="0":e.cart.list_selected[s].discount=S(A(e.cart.list_selected[s].discount.toString())),e.cart.list_selected[s].money_amount=e.cart.list_selected[s].quan*Number(A(e.cart.list_selected[s].unit_price))-Number(A(e.cart.list_selected[s].discount)),e.total+=e.cart.list_selected[s].money_amount,e.quantity+=e.cart.list_selected[s].quan,e.saleOrders.TotalDiscountAmount+=Number(A(e.cart.list_selected[s].discount)),e.cart.list_selected[s].stt=++s;null!==e.customers.ObjectName&&""!==e.customers.ObjectName&&(t=0==$(".colored-palegreen")[0].checked?e.customers.DiscountRateDefault:e.customers.DiscountRateDefault*e.total/100),0==$(".colored-palegreen")[0].checked?(e.payments=e.total-(e.txt_discount+t)/100*e.total,e.discount_money=(e.txt_discount+t)/100*e.total):(e.payments=e.total-(e.txt_discount+t),e.discount_money=e.txt_discount+t),e.saleOrders.TotalDiscountAmount+=e.discount_money,e.saleOrders.TotalDiscountAmountOC=e.saleOrders.TotalDiscountAmount;for(var s in e.cart.list_selected)e.cart.list_selected[s].discount2=e.cart.list_selected[s].money_amount/e.total*Number(e.discount_money),e.saleOrders.TotalVATAmount+=e.cart.list_selected[s].vat/100*(e.cart.list_selected[s].money_amount-e.cart.list_selected[s].discount2);e.saleOrders.TotalVATAmountOC=e.saleOrders.TotalVATAmount,e.payments=e.total+e.saleOrders.TotalVATAmount-Number(e.discount_money)+Number(A(e.shipping_amount)),M=!1,$("#collapseThrees").hide(1e3)}function y(){t.get("api/Customer/getall",null,function(t){e.listCustomer=t.data,e.filterList_cus=e.listCustomer},function(){console.log("load items failed")})}function f(){e.displayAdvance1="none",""===e.searchCus&&(e.filterList_cus=e.listCustomer,e.customers.displayAdvance="none",e.customers.Tel=null,e.customers.ObjectName=null,e.customers.Email=null,e.customers.ObjectAddress=null),""!==e.searchCus&&(e.diss="block")}function O(){"none"===e.diss?e.diss="block":e.diss="none"}function h(){0==$(".colored-palegreen")[0].checked&&($("#txt_discount")[0].value<0&&(e.txt_discount=0),$("#txt_discount")[0].value>100&&(e.txt_discount=100))}function P(){"block"==e.dis3?e.dis3="none":e.dis3="block"}function g(){"block"==e.dis4?e.dis4="none":e.dis4="block"}function b(){e.update_info(),e.dis3="none"}function S(e){e-=-.5;for(var t=new String(e),s="",o=0;o<t.length&&"."!=t[o];o++)s+=t[o];for(var l="",a=0,o=s.length-1;o>=0;o--)a++,l+=s[o],3==a&&0!=o&&(l+=",",a=0);for(var i=new String(l),n="",o=i.length-1;o>=0;o--)n+=i[o];return n}function A(e){for(var t=new String(e),s="",o=0;o<t.length;o++)","!=t[o]&&(s+=t[o]);return s}function T(){e.cart.list_selected=[],e.total=0,e.quantity=0,e.discount_money=0,e.payments=0,e.guest_money_value=0,e.guest_money=0,e.debt=0,e.txt_discount=0,e.searchText=0}function N(o,l){if(o<e.cart.list_selected.length)e.saleOrdersDetail.VoucherID=l.VoucherID,e.saleOrdersDetail.ItemID=e.cart.list_selected[o].ID,e.saleOrdersDetail.Quantity=e.cart.list_selected[o].quan,e.saleOrdersDetail.QuantityConvert=e.saleOrdersDetail.Quantity,e.saleOrdersDetail.UnitPriceOC=Number(A(e.cart.list_selected[o].unit_price)),e.saleOrdersDetail.UnitPrice=e.saleOrdersDetail.UnitPriceOC,e.saleOrdersDetail.UnitPriceConvertOC=e.saleOrdersDetail.UnitPriceOC,e.saleOrdersDetail.UnitPriceConvert=e.saleOrdersDetail.UnitPriceOC,e.saleOrdersDetail.AmountOC=e.cart.list_selected[o].money_amount,e.saleOrdersDetail.Amount=e.saleOrdersDetail.AmountOC,e.saleOrdersDetail.DiscountAmountOC=Number(A(e.cart.list_selected[o].discount)),e.saleOrdersDetail.DiscountAmount=e.saleOrdersDetail.DiscountAmountOC,e.saleOrdersDetail.DiscountReason=e.cart.list_selected[o].DiscountReason,e.saleOrdersDetail.DiscountRate=Number(A(e.cart.list_selected[o].discount))/(e.cart.list_selected[o].quan*Number(A(e.cart.list_selected[o].unit_price)))*100,e.saleOrdersDetail.VATAmountOC=e.cart.list_selected[o].vat*e.saleOrdersDetail.AmountOC,e.saleOrdersDetail.VATAmount=e.saleOrdersDetail.VATAmountOC,e.saleOrdersDetail.VATRate=e.cart.list_selected[o].vat,e.saleOrdersDetail.SortOrder=e.cart.list_selected[o].stt,e.saleOrdersDetail.OutwardPrice=e.saleOrdersDetail.UnitPriceOC,e.saleOrdersDetail.OutwardAmount=e.saleOrdersDetail.AmountOC,e.saleOrdersDetail.SpecialConsumeTaxRate=0,e.saleOrdersDetail.SpecialConsumeTaxAmountOC=0,e.saleOrdersDetail.SpecialConsumeTaxAmount=0,e.saleOrdersDetail.SpecialConsumeUnitPriceOC=0,e.saleOrdersDetail.SpecialConsumeUnitPrice=0,e.saleOrdersDetail.ConvertRate=0,e.saleOrdersDetail.UnitPriceAfterTaxOC=0,e.saleOrdersDetail.UnitPriceAfterTax=0,e.saleOrdersDetail.AmountAfterTaxOC=0,e.saleOrdersDetail.AmountAfterTax=0,e.saleOrdersDetail.DiscountAmountAfterTax=0,e.saleOrdersDetail.DiscountAmountAfterTaxOC=0,e.saleOrdersDetail.OutwardPriceConvert=0,t.post("api/saleOrderDetail/create",e.saleOrdersDetail,function(){N(o+1,l)},function(){s.displayError("Thêm mới không thành công")});else{var a=document.getElementById("inputEmail3").value;s.displaySuccess("Đơn hàng đã được thêm mới."),e.saleOrders.VoucherID=l.VoucherID,a=e.saleOrders.VoucherDate,n.go("saleOrder_Detail",{id:l.VoucherID})}}function C(){for(var o=!1,l=0;l<e.cart.list_selected.length;l++){if("0"===e.cart.list_selected[l].unit_price||null===e.cart.list_selected[l].unit_price||void 0===e.cart.list_selected[l].unit_price){o=!1;break}o=!0}o===!0?null!==e.customers.ObjectName&&""!==e.customers.ObjectName?(""==$("#txt_discount")[0].value&&(e.txt_discount=0,e.discount_money=0),e.saleOrders.StatusID=7,e.saleOrders.IsShowUnitConvert=!0,e.saleOrders.IsAttachList=!0,Number(A(e.shipping_amount))>=0?e.saleOrders.ShippingAmount=Number(A(e.shipping_amount)):e.saleOrders.ShippingAmount=0,e.saleOrders.CommisionAmount=0,e.saleOrders.CommisionAmountOC=e.saleOrders.CommisionAmount,e.saleOrders.SortOrder=0,e.saleOrders.IsPosted=!0,e.saleOrders.TotalOutwardAmount=0,e.saleOrders.BranchID=e.account.BranchID,e.saleOrders.DiscountAmountOC=e.discount_money,e.saleOrders.DiscountAmount=e.saleOrders.DiscountAmountOC,e.saleOrders.DiscountRate=100*e.discount_money/e.total,e.saleOrders.TotalAmountOC=e.total,e.saleOrders.TotalAmount=e.saleOrders.TotalAmountOC,null==e.customers.ObjectID?(e.customers1.ObjectName=e.customers.ObjectName,e.customers1.Email=e.customers.Email,e.customers1.Tel=e.customers.Tel,e.customers1.ObjectAddress=e.customers.ObjectAddress,null==e.customers.ObjectName&&null==e.customers.Email&&null==e.customers.Tel&&null==e.customers.ObjectAddress?(e.saleOrders.ObjectID="77ffeb25-befb-4996-bfe4-dcb3a6646f0a",e.saleOrders.PromotionID=U,t.post("api/saleOrder/create",e.saleOrders,function(e){N(0,e.data)},function(){s.displayError("Thêm mới không thành công.")})):t.post("api/Customer/create",e.customers1,function(o){s.displaySuccess("khách hàng "+o.data.ObjectName+" đã được thêm mới."),e.saleOrders.ObjectID=o.data.ObjectID,e.saleOrders.PromotionID=U,t.post("api/saleOrder/create",e.saleOrders,function(e){N(0,e.data)},function(){s.displayError("Thêm mới không thành công.")})},function(){s.displayError("Thêm mới khách hàng không thành công.")})):(e.saleOrders.ObjectID=e.customers.ObjectID,e.saleOrders.PromotionID=U,t.post("api/saleOrder/create",e.saleOrders,function(e){N(0,e.data)},function(){s.displayError("Thêm mới không thành công.")}))):s.displayWarning("Bạn cần nhập thông tin khách hàng !"):s.displayWarning("Bạn cần nhập đầy đủ đơn giá !")}function v(){$("#collapseThrees").show(1e3),0==M&&(e.listNew=[],e.listSalesPromotionNew=[],t.get("api/salespromotiondetail/getall",null,function(s){e.listSalesPromotionDetail=s.data;for(i in e.listSalesPromotionDetail)if(0==e.listSalesPromotionDetail[i].PromotionType)null!==e.listSalesPromotionDetail[i].ConditionsMin&&e.listSalesPromotionDetail[i].ConditionsMin<=e.payments&&e.payments<=e.listSalesPromotionDetail[i].ConditionsMax?e.listSalesPromotionNew.push(e.listSalesPromotionDetail[i]):(e.disPr="none !important",e.disPr1="block !important");else for(j in e.cart.list_selected)e.listSalesPromotionDetail[i].ItemID==e.cart.list_selected[j].ID&&e.listSalesPromotionDetail[i].QuantityItem<=e.cart.list_selected[j].quan&&e.listSalesPromotionNew.push(e.listSalesPromotionDetail[i]);t.get("api/salespromotion/getall/",null,function(t){e.listSalesPromotion=t.data;var s,o=0;for(k in e.listSalesPromotionNew)for(l in e.listSalesPromotion)s=new Date(e.listSalesPromotion[l].CreateDate),e.listSalesPromotionNew[k].VoucherID==e.listSalesPromotion[l].VoucherID&&1==e.listSalesPromotion[l].Status&&x>=s&&e.listSalesPromotion[l].ApplyQuantity>0&&1==e.listSalesPromotion[l].Status&&(e.listNew[o]={},e.listNew[o].ApplyQuantity=e.listSalesPromotion[l].ApplyQuantity,e.listNew[o].BranchID=e.listSalesPromotion[l].BranchID,e.listNew[o].CreateDate=e.listSalesPromotion[l].CreateDate,e.listNew[o].Description=e.listSalesPromotion[l].Description,e.listNew[o].Expirydate=e.listSalesPromotion[l].Expirydate,e.listNew[o].PromotionName=e.listSalesPromotion[l].PromotionName,e.listNew[o].VoucherType=e.listSalesPromotion[l].VoucherType,e.listNew[o].PromotionValue=e.listSalesPromotionNew[k].PromotionValue,e.listNew[o].Object=e.listSalesPromotion[l].Object,e.listNew[o].Status=e.listSalesPromotion[l].Status,e.listNew[o].VoucherDate=e.listSalesPromotion[l].VoucherDate,e.listNew[o].VoucherID=e.listSalesPromotion[l].VoucherID,e.listNew[o].VoucherNo=e.listSalesPromotion[l].VoucherNo,e.listNew[o].VoucherTypeDetail=e.listSalesPromotionNew[k].VoucherType,e.listNew[o].ItemID=e.listSalesPromotionNew[k].ItemID,0==e.listSalesPromotion[l].VoucherType?e.listNew[o].VoucherType1="CK Σ đơn hàng":e.listNew[o].VoucherType1="CK theo từng hàng hóa",o++);if(e.listNew.length>=1)for(var a=0;a<e.listNew.length;a++)for(var i=a+1;i<e.listNew.length;i++)e.listNew[a].VoucherID==e.listNew[i].VoucherID&&e.listNew.splice(i,1);0!==e.listNew.length&&(e.disPr="block !important",e.disPr1="none !important"),q=null,M=!0,luu=parseInt(e.saleOrders.DiscountAmountOC)})},function(){console.log("load items failed")}))}function I(l,a,i,n,c){if(U=n,e.disabled="block",e.disabled1="none",q!==n){e.ckkm=0;var r=0,u=0;0==c?null!==l?(w=new Date(l),x>w?s.displayWarning("Khuyến mại hết hạn"):(V=0,R=0,1==a?(V=i,R=e.payments*V/100,e.payments=e.payments-R+e.discount_money,e.ckkm=R,e.saleOrders.TotalDiscountAmountOC=e.ckkm+e.discount_money):(V=i,R=V,e.payments=e.payments-R+e.discount_money,e.ckkm=V+e.discount_money,e.saleOrders.TotalDiscountAmountOC=e.ckkm+e.discount_money))):(V=0,R=0,1==a?(V=e.payments*i/100,R=e.discount_money+V,e.payments=e.payments-R,e.ckkm=V+e.discount_money,e.saleOrders.TotalDiscountAmountOC=e.ckkm+e.discount_money,U=n):(V=e.discount_money+i,R=V,e.payments=e.payments-R,e.ckkm=i,e.saleOrders.TotalDiscountAmountOC=e.ckkm+e.discount_money)):null!==l?(w=new Date(l),x>w?s.displayWarning("Khuyến mại hết hạn"):t.get("api/salespromotiondetail/getbyid/"+n,null,function(t){e.SalesPromotionTemporary=t.data;for(k in e.cart.list_selected)for(o in e.SalesPromotionTemporary)e.cart.list_selected[k].ID==e.SalesPromotionTemporary[o].ItemID&&(1==e.SalesPromotionTemporary[o].VoucherType?(R=e.cart.list_selected[k].money_amount*e.SalesPromotionTemporary[o].PromotionValue/100+Number(e.cart.list_selected[k].discount),e.cart.list_selected[k].discount=S(e.cart.list_selected[k].money_amount-R),e.cart.list_selected[k].money_amount=R,u+=Number(A(e.cart.list_selected[k].discount)),r+=R):(V=Number(e.cart.list_selected[k].discount)+e.SalesPromotionTemporary[o].PromotionValue,R=e.cart.list_selected[k].money_amount-V,e.cart.list_selected[k].discount=S(V),e.cart.list_selected[k].money_amount=R,r+=R,u+=V));e.saleOrders.TotalDiscountAmountOC+=u,e.ckkm=u,e.payments-=e.ckkm})):t.get("api/salespromotiondetail/getbyid/"+n,null,function(t){e.SalesPromotionTemporary=t.data;for(k in e.cart.list_selected)for(o in e.SalesPromotionTemporary)e.cart.list_selected[k].ID==e.SalesPromotionTemporary[o].ItemID&&(1==e.SalesPromotionTemporary[o].VoucherType?(R=e.cart.list_selected[k].money_amount*e.SalesPromotionTemporary[o].PromotionValue/100+Number(e.cart.list_selected[k].discount),e.cart.list_selected[k].discount=S(e.cart.list_selected[k].money_amount-R),e.cart.list_selected[k].money_amount=R,u+=Number(A(e.cart.list_selected[k].discount)),r+=R):(V=Number(e.cart.list_selected[k].discount)+e.SalesPromotionTemporary[o].PromotionValue,R=e.cart.list_selected[k].money_amount-V,e.cart.list_selected[k].discount=S(V),e.cart.list_selected[k].money_amount=R,r+=R,u+=V));e.saleOrders.TotalDiscountAmountOC+=u,e.ckkm=u,e.payments-=e.ckkm}),q=n,e.saleOrders.TotalDiscountAmountOC=e.ckkm+e.discount_money,e.payments=e.total-e.saleOrders.TotalDiscountAmountOC}}e.ckkm=0,e.disabled="none",e.disabled1="block",e.filterList=[];var x=new Date;e.account={},t.get("api/account/users",null,function(s){e.account=s.data,t.get("api/itemOption/AutoComplete?BranchID="+e.account.BranchID,null,function(t){e.filterList=t.data})}),e.displaycart="block",e.getCode=c,e.getCode(),e.dis="none",e.searchText="",e.search=r,$(document).ready(function(){$(window).keydown(function(e){return 13==e.keyCode?(e.preventDefault(),!1):void 0})}),e.cart={list_selected:[],customer:{ObjectID:"77ffeb25-befb-4996-bfe4-dcb3a6646f0a",ObjectName:"Khách vãng lai"}},e.total=0,e.quantity=0,e.vat=0,e.shipping_amount="0",e.discount_item_Click=u,e.changeDiscount=d,e.changeStatusDiscount=m,e.ApplyDiscount=_,e.chooseProduct=p,e.update_info=D,e.delete_itemselected=function(t){for(var s in e.cart.list_selected)e.cart.list_selected[s].ID.toLowerCase().indexOf(t.toLowerCase())>-1&&e.cart.list_selected.splice(s,1);e.displaycart="block",e.ckkm=0,e.discount_money=0,e.update_info()},e.listCustomer=[],e.filterList_cus=[],e.getcustomer=y,e.getcustomer(),e.diss="none",e.searchCus="",e.Search_Customer=f,e.autocoplete_customer_click=O,e.customers={ObjectID:null,ObjectCode:null,ObjectName:null,ObjectAddress:null,ObjectCategoryID:null,ObjectKind:2,Tel:null,Email:null,Debt:0,AccumulativePoint:0,Status:!0,BankAccount:null,BankName:null,TaxCode:null,CaringStaff:null,Sex:null,Description:null,displayAdvance:"none"},e.customers1={ObjectCode:null,ObjectName:null,ObjectAddress:null,ObjectCategoryID:null,ObjectKind:2,Tel:null,Email:null,Debt:0,AccumulativePoint:0,Status:!0,BankAccount:null,BankName:null,TaxCode:null,CaringStaff:null,Sex:null,Description:null},e.choose_Cus=function(s){t.get("api/Customer/getbyid/"+s.ObjectID,null,function(s){if(e.customers=s.data,e.searchCus=e.customers.ObjectName,e.diss="none",e.customers.displayAdvance="block",2===e.customers.ApplyIncentives){if(t.get("api/pricePolicy/getbyid/"+e.customers.PricePolicyDefault,null,function(t){e.customers.PricePolicyDefaultName=t.data.PricePolicyName},function(e){console.log(e.data)}),t.get("api/paymentSchedule/getbyid/"+e.customers.PaymentScheduleDefault,null,function(t){e.customers.PaymentScheduleDefaultName=t.data.PaymentScheduleName},function(e){console.log(e.data)}),1===e.customers.PaymentMethodDefault?e.customers.PaymentMethodDefaultName="Tiền mặt":(2===e.customers.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="Chuyển khoản"),3===e.customers.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="COD")),e.cart.list_selected.length>0)for(var o in e.cart.list_selected)null!==e.customers.TaxRateDefault&&(e.cart.list_selected[o].vat=e.customers.TaxRateDefault),"3048ffe8-e2c8-4b43-a8a5-766ad6643a83"===e.customers.PricePolicyDefault.toString()?e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].saleprice.toString()):("f53cecc7-5a7b-44b9-894b-c6b18ac85d49"===e.customers.PricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].WholesalePrice.toString())),"155acc95-47be-4169-a73a-872aec588f54"===e.customers.PricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].PurchasePrice.toString()))),e.update_info()}else{if(1===e.customers.ApplyIncentives){var l={};t.get("api/objectCategory/getbyid/"+e.customers.ObjectCategoryID,null,function(s){if(l=s.data,t.get("api/pricePolicy/getbyid/"+l.PricePolicyDefault,null,function(t){e.customers.PricePolicyDefault=t.data.PricePolicyID,e.customers.PricePolicyDefaultName=t.data.PricePolicyName},function(){console.log("pricePolicy2")}),t.get("api/paymentSchedule/getbyid/"+l.PaymentScheduleDefault,null,function(t){e.customers.PaymentScheduleDefault=t.data.PaymentScheduleID,e.customers.PaymentScheduleDefaultName=t.data.PaymentScheduleName},function(){console.log("paymentSchedule2")}),1===l.PaymentMethodDefault?e.customers.PaymentMethodDefaultName="Tiền mặt":(2===l.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="Chuyển khoản"),3===l.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="COD")),e.customers.TaxRateDefault=l.TaxRateDefault,e.customers.DiscountRateDefault=l.DiscountRateDefault,e.cart.list_selected.length>0){e.customers.DiscountRateDefault=l.DiscountRateDefault;for(var o in e.cart.list_selected)null!==l.TaxRateDefault&&(e.cart.list_selected[o].vat=l.TaxRateDefault),"3048ffe8-e2c8-4b43-a8a5-766ad6643a83"===l.PricePolicyDefault.toString()?e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].saleprice.toString()):("f53cecc7-5a7b-44b9-894b-c6b18ac85d49"===l.PricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].WholesalePrice.toString())),"155acc95-47be-4169-a73a-872aec588f54"===l.PricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].PurchasePrice.toString()))),e.update_info()}},function(){console.log("vendorCategory")})}if(3===e.customers.ApplyIncentives){var a={};t.get("api/account/store",null,function(s){t.get("api/configStore/getConfig?manageStoreID="+s.data.ManageStoreID,null,function(s){if(a=s.data,t.get("api/pricePolicy/getbyid/"+a.SalePricePolicyDefault,null,function(t){e.customers.PricePolicyDefault=t.data.PricePolicyID,e.customers.PricePolicyDefaultName=t.data.PricePolicyName},function(){console.log("pricePolicy2")}),t.get("api/paymentSchedule/getbyid/"+a.PaymentScheduleDefault,null,function(t){e.customers.PaymentScheduleDefault=t.data.PaymentScheduleID,e.customers.PaymentScheduleDefaultName=t.data.PaymentScheduleName},function(){console.log("paymentSchedule2")}),1===a.PaymentMethodDefault?e.customers.PaymentMethodDefaultName="Tiền mặt":(2===a.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="Chuyển khoản"),3===a.PaymentMethodDefault&&(e.customers.PaymentMethodDefaultName="COD")),e.customers.TaxRateDefault=a.SaleTaxDefault,e.cart.list_selected.length>0)for(var o in e.cart.list_selected)null!==a.SaleTaxDefault&&(e.cart.list_selected[o].vat=a.SaleTaxDefault),"3048ffe8-e2c8-4b43-a8a5-766ad6643a83"===a.SalePricePolicyDefault.toString()?e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].saleprice.toString()):("f53cecc7-5a7b-44b9-894b-c6b18ac85d49"===a.SalePricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].WholesalePrice.toString())),"155acc95-47be-4169-a73a-872aec588f54"===a.SalePricePolicyDefault.toString()&&(e.cart.list_selected[o].unit_price=S(e.cart.list_selected[o].PurchasePrice.toString()))),e.update_info()},function(){console.log("pricePolicy2")})},function(){console.log("vendorCategory")})}}})},e.displayAdvance1="none",e.AdvanceSettingClick=function(){"none"===e.displayAdvance1?e.displayAdvance1="block":e.displayAdvance1="none"},$(document).click(function(t){"block"==e.dis&&"txt_search"!=t.target.id&&(e.dis="none"),"autocoplete_customer"!=t.target["class"]}),e.changeUNiT=h,e.change=function(){0==$(".colored-palegreen")[0].checked&&(e.txt_discount<0&&(e.txt_discount=0),e.txt_discount>100&&(e.txt_discount=100))},e.sale=P,e.dis3="none",e.sale1=g,e.dis4="none",e.txt_reason=null,e.txt_discount=0,e.discount_money=0,e.payments=0,e.discount=b,e.Currency=S,e.ConvertNumber=A,e.guest_money=0,e.guest_money_value=0,e.debt=0,e.change_guest_money=function(){e.guest_money=S(A(e.guest_money)),e.debt=A(e.guest_money)-e.payments,e.guest_money_value=A(e.guest_money)},e.saveandcontinue=function(){T(),s.displaySuccess("Thêm đơn hàng thành công!")},e.saleOrdersDetail={DiscountAmountOC:0,DiscountAmount:0,Amount:0,AmountOC:0,VATAmount:0,VATAmountOC:0},e.AddSaleOrdersDetail=N,e.saleOrders={DiscountRate:0,DiscountAmountOC:0,DiscountAmount:0,TotalAmountOC:0,TotalAmount:0,TotalDiscountAmountOC:0,TotalDiscountAmount:0,TotalVATAmountOC:0,TotalVATAmount:0,TotalOutwardAmount:0,IsPosted:!0,SortOrder:0,CommisionAmountOC:0,CommisionAmount:0,ShippingAmount:0,IsAttachList:!0,IsShowUnitConvert:!0,StatusID:1,VoucherType:10,VoucherDate:new Date},e.AddSaleOrders=C,e.lsUser=[],e.getUser=function(){t.get("api/account/GetUser",null,function(t){e.lsUser=t.data},function(){console.log("load lsUser failed")})},e.getUser(),e.DonGiaoHang={},e.lsTransporter=[],e.Transporter=function(){t.get("api/employee/getallTransporter",null,function(t){e.lsTransporter=t.data},function(){console.log("load Transporter failed")})},e.Transporter(),e.getSalesPromotion=v,e.listSalesPromotion=[],e.listSalesPromotionDetail=[],e.CalculatePromotion=I;var w,V,R,M=!1,U=null,q=null;e.SalesPromotionTemporary=[]}e.controller("saleOrderAddController",t),t.$inject=["$scope","apiService","notificationService","$ngBootbox","$state"]}(angular.module("tiktak.saleOrder"));