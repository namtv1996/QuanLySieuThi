!function(e){function a(e,a,t,s,n){function r(e,a){var t=e.slice(0,a);return e=e.length>=a?t+"...":t}function o(a,t,s){V=s,e.Districts=""+t+" - "+a;for(var i=0;i<e.Wards.length;i++)e.Wards[i].DistrictID==s&&(e.Wards_list.push(e.Wards[i]),T++)}function l(a,t){e.Wards1=t,N=a}function d(){a.get("api/Partner/getall",null,function(t){e.listDelivery=t.data;for(i in e.listDelivery)"GHN"==e.listDelivery[i].PartnerName&&(e.Usesignup.Email=e.listDelivery[i].NameSignIn,e.Usesignup.Password=e.listDelivery[i].PassSignIn,a.post("api/transportpartners/GHNSignIn",e.Usesignup,function(t){var s=JSON.parse(""+t.data);e.Usesignup.token=s.data.Token,a.post("api/transportpartners/GHNGetHubs",e.Usesignup,function(a){var t=JSON.parse(""+a.data);e.GHNGetHubs=t.data})}))})}function c(a,t,s){H=a,e.CreateOrder.FromDistrictID=t,e.nameHuns=s}function p(){a.get("api/transporter/getall",null,function(t){e.transporter_list=t.data,e.delivery_voucher.TransporterID=e.transporter_list[0].ObjectID,e.delivery_voucher.TransporterName=e.transporter_list[0].ObjectName,e.delivery_voucher.contact=e.transporter_list[0].Tel,a.post("api/transportpartners/GHNGetDistricts",null,function(t){var s=JSON.parse(""+t.data);e.Districts_list=s.data,a.post("api/transportpartners/GHNGetWards",null,function(a){var t=JSON.parse(""+a.data);e.Wards=t.data.Wards})})},function(){console.log("transport failed")}),e.delivery_voucher.VoucherNo=e.pakage[0].VoucherNo,e.delivery_voucher.OriginalVoucherNo=e.pakage[0].VoucherNo,e.delivery_voucher.VoucherDate=new Date,4==e.saleOrders.StatusID&&(e.delivery_voucher.TotalAmount=0),45==e.saleOrders.StatusID&&(e.delivery_voucher.TotalAmount=v(e.Infopay.customerpay)),2==e.saleOrders.StatusID&&(e.delivery_voucher.TotalAmount=v((e.saleOrders.TotalAmountOC+e.saleOrders.TotalVATAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount).toString())),e.delivery_voucher.ShippingAmount=v(e.saleOrders.ShippingAmount.toString()),e.delivery_voucher.ObjectID=e.saleOrders.ObjectID,e.delivery_voucher.ObjectName=e.customer.ObjectName,e.delivery_voucher.ObjectAddress=e.customer.ObjectAddress,e.delivery_voucher.ObjectTel=e.customer.Tel,e.delivery_voucher.BranchID=e.saleOrders.BranchID,e.delivery_voucher.StatusID=0}function u(t,s){e.delivery_voucher.TransporterID=t,e.nametransport=s,a.get("api/transporter/getbyid/"+t,null,function(a){e.delivery_voucher.TransporterID=t,e.delivery_voucher.TransporterName=a.data.ObjectName,e.delivery_voucher.contact=a.data.Tel},function(){console.log("transport failed")})}function y(t){void 0!=t&&(e.delivery_voucher.VoucherNo=t),e.delivery_voucher.ObjectAddress=e.Districts,e.delivery_voucher.TotalAmount=Number(I(e.delivery_voucher.TotalAmount)),e.delivery_voucher.ShippingAmount=Number(I(e.delivery_voucher.ShippingAmount)),a.post("api/saleOrder/create_delivery",e.delivery_voucher,function(t){4==e.saleOrders.StatusID&&(e.saleOrders.StatusID=1,e.saleOrders.SortOrder=2),45==e.saleOrders.StatusID&&(e.saleOrders.StatusID=15,e.saleOrders.SortOrder=3),2==e.saleOrders.StatusID&&(e.saleOrders.StatusID=3,e.saleOrders.SortOrder=1),e.saleOrders.VoucherDate=new Date(e.saleOrders.VoucherDate),a.put("api/saleOrder/update",e.saleOrders,function(){e.displayfunc()}),m(0,t.data)},function(){console.log("transport failed")})}function h(){void 0===e.delivery_voucher.ShippingAmount?e.delivery_voucher.ShippingAmount="0":e.delivery_voucher.ShippingAmount=v(I(e.delivery_voucher.ShippingAmount)),void 0===e.delivery_voucher.TotalAmount?e.delivery_voucher.TotalAmount="0":e.delivery_voucher.TotalAmount=v(I(e.delivery_voucher.TotalAmount))}function O(){1==e.frmAddDeliveryVoucher.$valid?"GHN"==e.nametransport?(e.CreateOrder.ClientAddress=e.Districts,e.CreateOrder.token=e.Usesignup.token,e.CreateOrder.ToDistrictID=V,e.CreateOrder.ToWardCode=N,e.CreateOrder.ClientContactName=e.delivery_voucher.ObjectName,e.CreateOrder.ClientContactPhone=e.customer.Tel,e.CreateOrder.ClientHubID=H,e.CreateOrder.CoDAmount=Number(I(e.delivery_voucher.TotalAmount)),e.CreateOrder.Content="Đơn hàng tạo từ tiktac.vn",e.CreateOrder.CouponCode="",e.CreateOrder.CustomerName=e.delivery_voucher.ObjectName,e.CreateOrder.ExternalCode=e.delivery_voucher.VoucherNo,e.CreateOrder.ExternalReturnCode="",e.CreateOrder.InsuranceFee=0,e.CreateOrder.Note="Đơn hàng tạo từ tiktac.vn",e.CreateOrder.ReturnContactPhone="",e.CreateOrder.serviceID=53321,e.CreateOrder.SealCode="tem niêm phong",e.CreateOrder.ReturnContactName="",e.CreateOrder.ReturnAddress="",a.post("api/transportpartners/GHNCreateOrder",e.CreateOrder,function(e){var a=JSON.parse(""+e.data);"Success"==a.msg?y(a.data.OrderCode):(console.log("transport failed"),t.displayError())},function(){console.log("transport failed"),t.displayError(objxx.msg)})):y():t.displayWarning("Bạn cần nhập đầy đủ các mục dữ liệu bắt buộc !!")}function m(s,i){e.delivery_voucher_detail=e.saleOrdersDetail,s<e.saleOrdersDetail.length?(e.delivery_voucher_detail[s].VoucherID=i.VoucherID,a.post("api/saleOrderDetail/create",e.delivery_voucher_detail[s],function(){m(s+1,i)},function(){console.log("Thêm mới chi tiết đóng gói không thành công")})):(t.displaySuccess("Đã tạo đơn giao hàng thành công  !"),e.getInfo(),a.get("api/transporter/getbyid/"+e.delivery_voucher.TransporterID,null,function(t){var s={};s=t.data,s.Debt=s.Debt+Number(e.delivery_voucher.TotalAmount)-Number(e.delivery_voucher.ShippingAmount),a.put("api/transporter/update",s,function(){},function(){console.log("update fail")})},function(){console.log("Thêm mới chi tiết đóng gói không thành công")}))}function g(){var t={params:{saleOrderVoucherNo:e.saleOrders.VoucherNo}};a.get("api/saleOrder/getSaleReturnBySaleOrderVoucherNo",t,function(a){e.listSaleReturnBySaleOrder=a.data,e.listSaleReturnBySaleOrder<=0?e.display.displayReturn="none":e.display.displayReturn="block"},function(e){console.log(e.data)})}function f(){1==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="block",e.display.dis5="block",e.display.dis7="none",e.display.dis8="none",e.display.dis9="block",e.display.dis10="none",e.style="col-md-12",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.act=!0,e.display.noclick1="none",e.display.act1=!0,e.display.noclick2="none",e.display.icon="available",e.state.title="Hoàn thành",e.display.icon1="fa fa-check-circle",e.display.icon2="fa fa-check-circle",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="none",e.display["import"]="block",e.display.dis13="block"),15==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="block",e.display.dis5="block",e.display.dis7="none",e.display.dis8="none",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.act=!0,e.display.noclick1="none",e.display.act1=!0,e.display.noclick2="none",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-check-circle",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="none",e.display["import"]="block",e.display.dis13="block"),2==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="none",e.display.dis8="block",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="block",e.display["import"]="none",e.display.dis13="none"),3==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="block",e.display.dis5="block",e.display.dis7="none",e.display.dis8="none",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.icon="available",e.display.act=!0,e.display.noclick1="none",e.display.act1=!0,e.display.noclick2="none",e.state.title="Đang giao dịch",e.display.icon1="fa fa-check-circle",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="none",e.display["import"]="block",e.display.dis13="block"),4==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="none",e.display.dis8="block",e.display.dis9="block",e.display.dis10="none",e.style="col-md-12",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-check-circle",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="block",e.display["import"]="none",e.display.dis13="none"),45==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="none",e.display.dis8="block",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="none",e.display.dis12="block",e.display["import"]="none",e.display.dis13="none"),7===e.saleOrders.StatusID&&(e.display.dis1="block",e.display.dis2="none",e.display.dis3="none",e.display.dis4="none",e.display.dis5="none",e.display.dis9="block",e.display.icon="not-available",e.state.title="Đặt hàng",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="none",e.display.dis11="block",e.display.dis12="none",e.display["import"]="none",e.display.dis13="none"),8==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="block",e.display.dis8="none",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.display.title="Chưa đóng gói",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="block",e.display.dis12="none",e.display["import"]="none",e.display.dis13="none"),9==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="block",e.display.dis8="none",e.display.dis9="block",e.style="col-md-12",e.display.dis10="none",e.display.title="Chưa đóng gói",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-check-circle",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="block",e.display.dis12="none",e.display["import"]="none",e.display.dis13="none"),95==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="block",e.display.dis8="none",e.display.dis9="block",e.display.dis10="block",e.style="col-md-8",e.display.title="Chưa đóng gói",e.display.act=!1,e.display.noclick1="",e.display.act1=!1,e.display.noclick2="",e.display.icon="available",e.state.title="Đang giao dịch",e.display.icon1="fa fa-spinner",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-spinner",e.display.task="block",e.display.dis11="block",e.display.dis12="none",e.display["import"]="none",e.display.dis13="none"),10==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="none",e.display.dis3="none",e.display.dis4="none",e.display.dis5="none",e.display.dis7="none",e.display.dis8="none",e.display.dis9="none",e.display.title="Chưa đóng gói",e.display.act=!0,e.display.noclick1="none",e.display.act1=!0,e.display.noclick2="none",e.display.icon="red",e.state.title="Đã hủy",e.display.task="block",e.display.dis13="none"),11==e.saleOrders.StatusID&&(e.display.dis1="none",e.display.dis2="block",e.display.dis3="block",e.display.dis4="none",e.display.dis5="none",e.display.dis7="none",e.display.dis8="none",e.display.dis10="none",e.display.dis9="none",e.display.title="Trả hàng",e.display.act=!0,e.display.noclick1="none",e.display.act1=!0,e.display.noclick2="none",e.display.icon="black",e.state.title="Đã trả",e.display.icon1="fa fa-check-circle",e.display.icon2="fa fa-spinner",e.display.icon3="fa fa-check-circle",e.display.task="block",e.pakage.length>0?e.display.title=e.pakage[0].VoucherNo:e.display.title="Hoàn thành",e.display.dis11="none",e.display.dis12="none",e.display["import"]="block",e.display.dis13="block"),0===e.saleOrders.SortOrder?(e.display.delivery="none",e.display.cod="none"):(1===e.saleOrders.SortOrder&&(e.display.delivery="block",e.display.cod="block",e.display.dis12="none",e.display.dis10="none",e.display["import"]="none"),2===e.saleOrders.SortOrder&&(e.display.delivery="block",e.display.cod="none",e.display.dis12="none",e.display.dis10="none",e.display["import"]="none"),3===e.saleOrders.SortOrder&&(e.display.delivery="block",e.display.cod="block",e.display.dis12="none",e.display.dis10="none",e.display["import"]="none"))}function k(s,i){s<e.saleOrdersDetail.length?(e.saleOrdersDetail[s].VoucherID=i.VoucherID,a.post("api/saleOrderDetail/create",e.saleOrdersDetail[s],function(){k(s+1,i)},function(){t.displayError("Thêm mới chi tiết đóng gói không thành công")})):e.getInfo()}function D(){e.saleOrders.VoucherType=30,e.saleOrders.OriginalVoucherNo=e.saleOrders.VoucherNo,e.saleOrders.StatusID=0,a.post("api/saleOrder/create_package",e.saleOrders,function(e){k(0,e.data)},function(){t.displayError("Thêm mới phiếu đóng gói không thành công")})}function b(){var e=document.getElementById("dvContents").innerHTML,a=document.createElement("iframe");a.name="frame1",a.style.position="absolute",a.style.top="-1000000px",document.body.appendChild(a);var t=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument;return t.document.open(),t.document.write("<html><head><title>Đơn hàng</title>"),t.document.write("</head><body>"),t.document.write(e),t.document.write("</body></html>"),t.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(a)},500),!1}function v(e){e-=-.5;for(var a=new String(e),t="",s=0;s<a.length;s++){if("."==a[s]){a[s+1]>="5"&&(t[s]=a[s]- -1);break}t+=a[s]}for(var i="",n=0,s=t.length-1;s>=0;s--)n++,i+=t[s],3==n&&0!=s&&(i+=",",n=0);for(var r=new String(i),o="",s=r.length-1;s>=0;s--)o+=r[s];return o}function I(e){for(var a=new String(e),t="",s=0;s<a.length;s++)","!=a[s]&&(t+=a[s]);return t}function S(){e.Infopay.customerpay=e.saleOrders.TotalAmountOC+e.saleOrders.TotalVATAmountOC-e.Infopay.customerpaid-I(e.Infopay.txt_customerpay)-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount,e.Infopay.txt_customerpay=v(I(e.Infopay.txt_customerpay))}function C(){a.get("api/Region/getaddress?key="+e.customer.ObjectState,null,function(a){e.listRegionaddress=a.data},function(){console.log("load items failed")})}function _(){a.get("api/Region/getaddress?key="+e.customer.ObjectDistrict,null,function(a){e.listRegionTown=a.data},function(){console.log("load items failed")})}function A(){a.get("api/Region/getone",null,function(a){e.listRegion=a.data},function(){console.log("load items failed")})}e.saleOrders={},e.saleOrdersDetail={},e.listItem={},e.listview=[],e.state={},e.method_of_receipt=1,e.method_of_payment="tien-mat",e.customer={},e.display={},e.receipt={},e.list_receipt={},e.Infopay={},e.pakage={},e.itemOption={Status:!0},e.method_of_delivery="",e.account={},a.get("api/account/users",null,function(t){e.account=t.data,a.get("api/branch/getbyid/"+e.account.BranchID,null,function(a){e.account.BranchName=a.data.BranchName})}),e.limitChar=r,e.displayfunc=f,e.delivery_voucher={},e.CreateOrder={token:"",PaymentTypeID:1,FromDistrictID:null,FromWardCode:"",ToDistrictID:1462,ToWardCode:"",Note:"",SealCode:"",ExternalCode:"",ClientContactName:"",ClientContactPhone:"",ClientAddress:"",CustomerName:"",CustomerPhone:"",ShippingAddress:"",CoDAmount:null,NoteCode:"",InsuranceFee:null,ClientHubID:null,ServiceID:null,ToLatitude:null,ToLongitude:null,FromLat:null,FromLng:null,Content:"",CouponCode:"",Weight:0,Length:0,Width:0,Height:0,CheckMainBankAccount:!1,serviceID:null,ReturnContactName:"",ReturnContactPhone:"",ReturnAddress:"",ReturnDistrictCode:"",ExternalReturnCode:"",IsCreditCreate:!0},e.transporter_list=[],e.Districts_list=[],e.Wards_list=[],e.Wards=[],e.getInfoDeliveryVoucher=p,e.GetWards=o,e.Submit=l;var T=0,N=null,V=null;e.Usesignup={token:null,Email:null,Password:null,ContactPhone:null,ContactName:null},e.NoteCode=[{name:"CHOTHUHANG"},{name:"CHOXEMHANGKHONGTHU"},{name:"KHONGCHOXEMHANG"}],e.ServiceList=[{id:53319,name:"6 giờ",content:"nội thành (nội vùng)"},{id:53320,name:"1 ngày",content:"nội thành (nội vùng)"},{id:53330,name:"Chuyển phát cá nhân tại điểm",content:"nội thành (nội vùng)"}],e.Usesignup={token:null},e.GHNGetHubs=[],e.GetDelivery=d,e.getHubs=c;var H=null;d(),e.nametransport="",e.changeTransporter=u,e.changeAmount=h,e.submit=y,e.AddDeliveryVoucher=O,e.delivery_voucher_detail=[],e.AddDeliveryVoucherDetail=m,e.getSaleReturnBySaleOrder=g,e.listSaleReturnBySaleOrder=[],e.getInfo=function(){e.saleOrdersDetail={},a.get("api/saleOrderDetail/getbyid/"+s.id,null,function(a){e.saleOrdersDetail=a.data}),a.get("api/saleOrder/getbyid/"+s.id,null,function(t){e.saleOrders=t.data,e.state.title="Đặt hàng",0==e.listview.length&&a.get("api/itemOption/getitemsaleinvoice1/"+e.saleOrders.VoucherID,null,function(a){e.listview=a.data}),a.get("api/Customer/getbyid/"+e.saleOrders.ObjectID,null,function(t){e.customer=t.data,e.customer.ObjectAddress_StringCut=r(e.customer.ObjectAddress,25),e.customer.Email_StringCut=r(e.customer.Email,25),e.selectDistrict(),e.selectTown(),a.get("api/saleOrder/getbyoriginalvoucherno?originalvoucherno="+e.saleOrders.VoucherNo,null,function(a){e.list_receipt=a.data,e.Infopay.customerpaid=0;for(var t in e.list_receipt)e.Infopay.customerpaid+=e.list_receipt[t].TotalAmountOC,e.list_receipt[t].sort=Number(t)+Number(1),20==e.list_receipt[t].VoucherType&&(e.list_receipt[t].method_of_payment="Tiền mặt"),21==e.list_receipt[t].VoucherType&&(e.list_receipt[t].method_of_payment="COD"),22==e.list_receipt[t].VoucherType&&(e.list_receipt[t].method_of_payment="Chuyển khoản");e.Infopay.customerpay=e.saleOrders.TotalAmountOC-e.Infopay.customerpaid-e.saleOrders.DiscountAmountOC+e.saleOrders.TotalVATAmountOC+e.saleOrders.ShippingAmount,e.Infopay.txt_customerpay=v(e.Infopay.customerpay)}),e.getSaleReturnBySaleOrder()}),a.get("api/saleOrder/getpackagebyoriginalvoucherno?originalvoucherno="+e.saleOrders.VoucherNo,null,function(t){e.pakage=t.data,0!==e.saleOrders.SortOrder&&a.get("api/saleOrder/getDeliveryOrderByPackageVoucherNo?packageVoucherNo="+e.pakage[0].VoucherNo,null,function(a){e.saleOrders.delivery_voucher_id=a.data[0].VoucherID,0===a.data[0].StatusID&&(e.delivery_status="Sử dụng giao hàng - "+a.data[0].VoucherNo+" - Đang giao hàng"),1===a.data[0].StatusID&&(e.delivery_status="Sử dụng giao hàng - "+a.data[0].VoucherNo+" - Hoàn thành"),4===a.data[0].StatusID&&(e.delivery_status="Sử dụng giao hàng - "+a.data[0].VoucherNo+" - Hủy giao hàng"),2!==a.data[0].StatusID&&3!==a.data[0].StatusID||(e.delivery_status="Sử dụng giao hàng - "+a.data[0].VoucherNo+" - Đã giao hàng")}),e.displayfunc()})},function(){t.displayError("Đơn hàng không tồn tại")})},e.AddPackingSlipssDetail=k,e.AddPackingSlips=D,e.Revise=function(s){if(e.saleOrders.VoucherDate=new Date(e.saleOrders.VoucherDate),"duyet_don"==s){e.saleOrders.StatusID=8,e.state.title="Đang giao dịch",a.put("api/saleOrder/update",e.saleOrders,function(){e.displayfunc()}),t.displaySuccess("Duyệt đơn hàng thành công!");var i={};a.get("api/Customer/getbyid/"+e.saleOrders.ObjectID,null,function(t){i=t.data,i.ObjectID===e.saleOrders.ObjectID&&(i.Debt=i.Debt+e.saleOrders.TotalAmount+e.saleOrders.TotalVATAmount-e.saleOrders.DiscountAmount+e.saleOrders.ShippingAmount,a.put("api/Customer/update",i))},function(){t.displayError("Thất bại !!")})}if("dong_goi"==s&&(7==e.saleOrders.StatusID&&(e.saleOrders.StatusID=2,a.put("api/saleOrder/update",e.saleOrders,function(){D()}),e.displayfunc(),t.displaySuccess("Đã đóng gói!")),8==e.saleOrders.StatusID&&(e.saleOrders.StatusID=2,a.put("api/saleOrder/update",e.saleOrders,function(){D()}),e.displayfunc(),t.displaySuccess("Đã đóng gói!")),9==e.saleOrders.StatusID&&(e.saleOrders.StatusID=4,a.put("api/saleOrder/update",e.saleOrders,function(){D()}),e.displayfunc(),t.displaySuccess("Đã đóng gói!")),95==e.saleOrders.StatusID&&(e.saleOrders.StatusID=45,a.put("api/saleOrder/update",e.saleOrders,function(){D()}),e.displayfunc(),t.displaySuccess("Đã đóng gói!"))),"xuat_kho"==s){4==e.saleOrders.StatusID&&(e.saleOrders.StatusID=1,a.put("api/saleOrder/update",e.saleOrders,function(){}),e.displayfunc(),t.displaySuccess("Đã xuất kho!")),45==e.saleOrders.StatusID&&(e.saleOrders.StatusID=15,a.put("api/saleOrder/update",e.saleOrders,function(){}),e.displayfunc(),t.displaySuccess("Đã xuất kho!")),2==e.saleOrders.StatusID&&(e.saleOrders.StatusID=3,a.put("api/saleOrder/update",e.saleOrders,function(){}),e.displayfunc(),t.displaySuccess("Đã xuất kho!"));var s={BranchID:e.account.BranchID,voucherID:e.saleOrders.VoucherID};a.put("api/stock/updateClosingQuantityStockCombo",s),a.put("api/saleOrder/UpdateInventory",s,function(){},function(){console.log="không update đk số lượng ^^"}),e["package"].StatusID=1,a.put("api/saleOrder/update",e["package"],function(){})}if("thanh_toan"==s){"tien-mat"==e.method_of_payment&&(e.receipt.VoucherType=20),"cod"==e.method_of_payment&&(e.receipt.VoucherType=21),"chuyen-khoan"==e.method_of_payment&&(e.receipt.VoucherType=22),e.receipt.ObjectID=e.saleOrders.ObjectID,e.receipt.BillPaid=1,e.receipt.DiscountRate=0,e.receipt.DiscountAmountOC=0,e.receipt.DiscountAmount=0,e.Infopay.txt_customerpay=I(e.Infopay.txt_customerpay),e.receipt.TotalAmountOC=e.Infopay.txt_customerpay,e.receipt.TotalAmount=e.receipt.TotalAmountOC,e.receipt.TotalDiscountAmountOC=0,e.receipt.TotalDiscountAmount=0,e.receipt.TotalVATAmountOC=0,e.receipt.TotalVATAmount=0,e.receipt.TotalOutwardAmount=0,e.receipt.IsPosted=1,e.receipt.SortOrder=1,e.receipt.CommisionAmountOC=0,e.receipt.CommisionAmount=0,e.receipt.IsAttachList=0,e.receipt.IsShowUnitConvert=0,e.receipt.StatusID=0,e.receipt.OriginalVoucherNo=e.saleOrders.VoucherNo,e.receipt.BranchID=e.account.BranchID,e.receipt.VoucherDate=new Date,45==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=4:e.saleOrders.StatusID=45,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})})),95==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=9:e.saleOrders.StatusID=95,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})})),15==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=1:e.saleOrders.StatusID=15,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})})),2==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=4:e.saleOrders.StatusID=45,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})})),3==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=1:e.saleOrders.StatusID=15,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})})),8==e.saleOrders.StatusID&&(Number(e.Infopay.customerpaid)+Number(e.Infopay.txt_customerpay)==Number(e.saleOrders.TotalAmountOC-e.saleOrders.DiscountAmountOC+e.saleOrders.ShippingAmount+e.saleOrders.TotalVATAmountOC)?e.saleOrders.StatusID=9:e.saleOrders.StatusID=95,a.put("api/saleOrder/update",e.saleOrders,function(){a.post("api/saleOrder/create_receipt",e.receipt,function(){t.displaySuccess("Thanh toán thành công"),e.getInfo()},function(){t.displayError("Thanh toán không thành công")})}));var i={};a.get("api/Customer/getbyid/"+e.saleOrders.ObjectID,null,function(t){i=t.data,i.ObjectID===e.saleOrders.ObjectID&&(0===i.Debt?i.Debt=i.Debt:i.Debt=i.Debt-e.Infopay.txt_customerpay,a.put("api/Customer/update",i))},function(){t.displayError("Thất bại !!")})}"huy_don"==s&&n.confirm("Bạn có chắc muốn hủy đơn hàng?").then(function(){e.saleOrders.StatusID=10,a.put("api/saleOrder/update",e.saleOrders,function(){t.displaySuccess("Hủy đơn hàng thành công")},function(){t.displayError("Không thành công")})})},e.printInvoice=b,e.Currency=v,e.ConvertNumber=I,e.customerpay_calculate=S,e.getInfo(),e.getRegion=A,e.listRegion=[],e.selectDistrict=C,e.listRegionaddress=[],e.selectTown=_,e.listRegionTown=[],e.getRegion()}e.controller("saleOrderDetailController",a),a.$inject=["$scope","apiService","notificationService","$stateParams","$ngBootbox"]}(angular.module("tiktak.saleOrder"));